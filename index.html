<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Bowling Plan-Maker</h1>
        <input type="text" id="searchBar" placeholder="Search for a player..." oninput="showSuggestions()">
        <div id="suggestions" class="suggestions"></div>
        <div id="dashboard"></div>
        <div id="plot-section" class="dashboard-row"></div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Cricket Stats. All rights reserved.</p>
    </div>

    <script>
        let playerData;
        let effsrResults;
        let bathandData;

        fetch('t20/stat360.json')
    .then(response => response.json())
    .then(data => { 
        playerData = data;
        console.log(Object.keys(playerData)); // Log all player names
    })
    .catch(error => console.error('Error loading player stats JSON:', error));

        fetch('t20/effsr_results.json')
            .then(response => response.json())
            .then(data => { effsrResults = data; })
            .catch(error => console.error('Error loading effsr results JSON:', error));

        fetch('t20/fshots_results.json')
            .then(response => response.json())
            .then(data => { fshotsResults = data; })
            .catch(error => console.error('Error loading effsr results JSON:', error));

        fetch('t20/bathand.json')
            .then(response => response.json())
            .then(data => { bathandData = data; })
            .catch(error => console.error('Error loading bathand JSON:', error));

        function renderPlayerCard(playerName) {
            document.getElementById('suggestions').innerHTML = ''; // Clear suggestions
            const dashboard = document.getElementById('dashboard');
            const plotSection = document.getElementById('plot-section');
            dashboard.innerHTML = '';
            plotSection.innerHTML = ''; // Clear previous plots

            const playerInfo = playerData[playerName];
            const effsrData = effsrResults[playerName];
            const fshotsData = fshotsResults[playerName];
            const bathand = bathandData[playerName];

            if (!playerInfo || !effsrData || !bathand || !fshotsData) {
                console.error(`Data missing for ${playerName}`);
                return;
            }

            // Access rank values
            const player360Rank = playerInfo.rank || 'N/A';
            const paceRank = effsrData.pacerank || 'N/A';
            const spinRank = effsrData.spinrank || 'N/A';
            const vspinRank = fshotsData.spinrank || 'N/A';
            const vpaceRank = fshotsData.pacerank || 'N/A';

            // Player info block
            const row = document.createElement('div');
            row.className = 'dashboard-row';

            const leftColumn = document.createElement('div');
            leftColumn.className = 'left-column';

            const playerCard = document.createElement('div');
            playerCard.className = 'info-block player-profile';
            playerCard.innerHTML = `
                <h2>${playerName}</h2> <span>(${bathand})</span>
                
                <p><strong>Pace Intent:</strong> <span class="stat-value">${effsrData.pace.toFixed(2)} <span class="rank-highlight">(RANK ${paceRank})</span></span></p>
                <p><strong>Spin Intent:</strong> <span class="stat-value">${effsrData.spin.toFixed(2)} <span class="rank-highlight">(RANK ${spinRank})</span></span></p>
                <p><strong>Pace Rel:</strong> <span class="stat-value">${(1/fshotsData.pace).toFixed(2)} <span class="rank-highlight">(RANK ${vpaceRank})</span></span></p>
                <p><strong>Spin Rel:</strong> <span class="stat-value">${(1/fshotsData.spin).toFixed(2)} <span class="rank-highlight">(RANK ${vspinRank})</span></span></p>
                <p><strong>360 Score:</strong> <span class="stat-value">${Math.round(playerInfo['360score'])} <span class="rank-highlight">(RANK ${player360Rank})</span></span></p>
            `;
            console.log(playerInfo['iww'])
            // Wagon Wheel block
            const wagonWheelCard = document.createElement('div');
            wagonWheelCard.className = 'wagon-wheel-block';
            wagonWheelCard.innerHTML = `
                <h2>Intelligent Wagon Wheel</h2>
                <img src="${playerInfo['iww']}" alt="Intelligent Wagon Wheel for ${playerName}">
            `;

            leftColumn.appendChild(playerCard);
            leftColumn.appendChild(wagonWheelCard);
            row.appendChild(leftColumn);

            // Plot Section (right column)
            const rightColumn = document.createElement('div');
            rightColumn.className = 'right-column';

            // Efficiency plot block
            const efficiencyBlock = document.createElement('div');
            efficiencyBlock.className = 'plot-block';
            efficiencyBlock.innerHTML = `<h2>Intent Progression</h2>`;
            const efficiencyPlot = document.createElement('img');
            efficiencyPlot.src = `plots/${playerName.split(' ').join('_')}_efficiency.png`;
            efficiencyBlock.appendChild(efficiencyPlot);
            rightColumn.appendChild(efficiencyBlock);
            
            const fshotsBlock = document.createElement('div');
            fshotsBlock.className = 'plot-block';
            fshotsBlock.innerHTML = `<h2>Vulnerability Plot</h2>`;
            const fshotsPlot = document.createElement('img');
            fshotsPlot.src = `vulplots/${playerName.split(' ').join('_')}_vulnerability.png`;
            fshotsBlock.appendChild(fshotsPlot);
            rightColumn.appendChild(fshotsBlock);
            // Target Deliveries plot block
            const targetDeliveriesBlock = document.createElement('div');
            targetDeliveriesBlock.className = 'plot-block';
            targetDeliveriesBlock.innerHTML = `<h2>Target Deliveries</h2>`;
            const weakspotPlot = document.createElement('img');
            weakspotPlot.src = `weakspots/${playerName.split(' ').join('_')}_ws.png`;
            targetDeliveriesBlock.appendChild(weakspotPlot);
            
            if (window.innerWidth < 768) {
        rightColumn.appendChild(targetDeliveriesBlock);  // Add to the right column on mobile
        row.appendChild(rightColumn);
        dashboard.appendChild(row);
    } else {
        row.appendChild(rightColumn);
            dashboard.appendChild(row);
            dashboard.appendChild(targetDeliveriesBlock); // Add to the dashboard for larger screens
    }
            
        }

        function showSuggestions() {
            const searchBar = document.getElementById('searchBar');
            const suggestionsDiv = document.getElementById('suggestions');
            const query = searchBar.value.toLowerCase();

            if (!query) {
                suggestionsDiv.innerHTML = '';
                return;
            }

            const matches = Object.keys(playerData).filter(player => player.toLowerCase().includes(query));
            suggestionsDiv.innerHTML = matches.map(player => `
                <div class="suggestion-item" onclick="renderPlayerCard('${player}')">${player}</div>
            `).join('');
        }
    </script>
</body>
</html>

